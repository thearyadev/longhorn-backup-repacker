# Longhorn Backup Repacker

Longhorn backups are stored as incremental block-segments of the original data. This is done to deuplicate and provide a lightweight interface for backups.

`longhorn-engine` provides a restore the backup to a raw (or cow) file, but only supports this via supported filesystem drivers, NFS and S3. This utility allows you to use a mounted filesystem. NFS and S3 are not supported. 

## Installation

Clone and build or download a pre-built binary from the [releases](https://github.com/thearyadev/longhorn-backup-repacker/releases) page.

## Usage

```
Usage of ./longhorn-backup-repacker:
  -backup-root string
        Backup root directory
  -outfile string
        Output file
  -target string
        Backup target
```

## Example
```bash 
./longhorn-backup-repacker -backup-root "/path/to/longhorn/backup/root" -outfile ./outfile.raw -target <volume_name>
```

## Limitations

* Only supports the `ext4` filesystem. This is untested on other file systems. The backup will successfully pack the data with any filesystem, but the physical device is usually smaller than the filesystem size. This device will appear corrupted, but simply needs to be filled with zeroes or shrink the file system. 

* This tool can only restore a full backup, and not an incremental segment of a backup.

* Currently only supports `lz4` decompression. `gzip` is WIP.

## Warning

This tool is not intended for use in production. It has been created by reverse engineering a backup generated by Longhorn v1.7, and may not work in future versions of Longhorn. 



